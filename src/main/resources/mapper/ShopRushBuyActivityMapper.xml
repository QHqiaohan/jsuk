<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jh.jsuk.dao.ShopRushBuyActivityDao">

  <!-- 通用查询映射结果 -->
  <resultMap id="BaseResultMap" type="com.jh.jsuk.entity.ShopRushBuyActivity">
    <id column="id" property="id"/>
    <result column="shop_id" property="shopId"/>
    <result column="rush_buy_id" property="rushBuyId"/>
    <result column="goods_size_id" property="goodsSizeId"/>
    <result column="goods_id" property="goodsId"/>
    <result column="is_del" property="isDel"/>
    <result column="is_use" property="isUse"/>
    <result column="publish_time" property="publishTime"/>
  </resultMap>

  <!-- 通用查询结果列 -->
  <sql id="Base_Column_List">
        id,shop_id, rush_buy_id, goods_id,goods_size_id, is_del,is_use, publish_time
    </sql>

  <select id="findVoByGoodsSizeId" resultType="com.jh.jsuk.entity.vo.RushBuyVo">
        select start_time,end_time,#{goodsSizeId} goods_size_id from js_shop_rush_buy b where
        b.id =  (SELECT rush_buy_id FROM `js_shop_rush_buy_activity` a
        where a.is_use and not a.is_del and a.goods_size_id = #{goodsSizeId}
        order by publish_time desc limit 1)
        limit 1
  </select>


  <resultMap id="vo" type="com.jh.jsuk.entity.vo.rushbuy.ShopRushBuyActivityVO" extends="BaseResultMap">
    <association property="good" column="goods_size_id" select="com.jh.jsuk.dao.ShopGoodsSizeDao.shortVo"/>
    <association property="time" column="rush_buy_id" select="com.jh.jsuk.dao.ShopRushBuyDao.shortVo"/>
    <association property="shop" column="shop_id" select="com.jh.jsuk.dao.ShopDao.shortVo"/>
  </resultMap>

  <select id="page" resultMap="vo">
    select <include refid="Base_Column_List"/> from js_shop_rush_buy_activity
    where not is_del
  </select>


</mapper>
