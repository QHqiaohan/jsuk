<html xmlns:th="http://www.thymeleaf.org">
<head>
    <base href="<%=basePath %>"/>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>用户</title>
    <link rel="stylesheet" type="text/css" href="static/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="static/res/css/main.css?v1"/>
</head>
<body>
<div style=" width:100%;height:100%;overflow:auto">
    <form class="layui-form" action="rolemenu/saveSysMenu" lay-filter="sysRole" id="sysRole"
          style="padding: 20px 10px;">
        <input type="hidden" name="roleId" id="roleId" value="${sysRole.role_id}">
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 100px">角色名称</label>
            <div class="layui-inline" style="width: 280px">
                <input type="text" name="roleName" lay-verType="tips" lay-verify="required|roleName" autocomplete="off"
                       placeholder="用户名" class="layui-input" value="${sysRole.role_name}">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 100px">角色标识</label>
            <div class="layui-inline" style="width: 280px">
                <input type="text" name="roleSign" autocomplete="off" placeholder="角色标识" class="layui-input"
                       value="${sysRole.role_sign}">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 100px">备注</label>
            <div class="layui-inline" style="width: 280px">
                <textarea placeholder="备注" name="remark" class="layui-textarea">${sysRole.remark}</textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" style="width: 100px;">角色</label>
            <div class="layui-input-block">
                <%--   <c:forEach items="${sysMenu}" var="menu" varStatus="i">
                       <div class="layui-inline" style="height: 20px">
                           <input type="checkbox"  lay-skin="primary" name="menus[${i.index}]" value="${menu.menu_id}" title="${menu.name}">
                       </div>
                   </c:forEach>--%>
                <div id="LAY-auth-tree-index" class="layui-inline"></div>
                <%-- // <div id="demo1"></div>--%>
            </div>
        </div>
        <div class="layui-form-item layui-hide">
            <div class="layui-inline">
                <button class="layui-btn layui-hide" lay-submit lay-filter="sysRole">立即提交</button>
            </div>
        </div>
    </form>
</div>
<script type="text/javascript" src="static/layui/layui.js"></script>

<script>

    layui.config({
        base: 'extends/',
    }).extend({
        authtree: 'authtree',
    });
    layui.use(['jquery', 'authtree'], function () {
        var $ = layui.jquery;
        var authtree = layui.authtree;
        var roleId = $("#roleId").val();
        $.ajax({
            url: 'menu/queryList',
            data: {roleId: roleId},
            dataType: 'json',
            success: function (data) {
                // 渲染时传入渲染目标ID，树形结构数据（具体结构看样例，checked表示默认选中），以及input表单的名字
                authtree.render('#LAY-auth-tree-index', data.data.trees, 'authids[]');
                // 监听自定义lay-filter选中状态，PS:layui现在不支持多次监听，所以扩展里边只能改变触发逻辑，然后引起了事件冒泡延迟的BUG，要是谁有好的建议可以反馈我
                form.on('checkbox(lay-check-auth)', function (data) {
                    // 注意这里：需要等待事件冒泡完成，不然获取叶子节点不准确。
                    setTimeout(function () {
                        // 获取选中的叶子节点
                        var leaf = authtree.getLeaf('#LAY-auth-tree-index');
                        console.log(leaf);
                    }, 100);
                });
            }
        })
    });
</script>
<script type="text/javascript" src="static/res/js/common.js"></script>
</body>
</html>
