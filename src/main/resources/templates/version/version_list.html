<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<title>文章列表--layui后台管理模板</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="/plugins/layui/css/layui.css" media="all" />
	<!--<link rel="stylesheet" href="/build/css/news.css" media="all" />-->
</head>
<body>
<table class="layui-hide" id="LAY_table_user" lay-filter="user"></table>

<script type="text/javascript" src="/plugins/layui/layui.js"  charset="utf-8"></script>

<script type="text/html" id="osType">
	{{#  if(d.osType == 0){ }}
	安卓
	{{#  } else if(d.osType == 1){ }}
	IOS
	{{# } }}
</script>
<script type="text/html" id="appType">
	{{#  if(d.appType == 1){ }}
	商家端
	{{#  } else if(d.appType == 2){ }}
	骑手端
	{{#  } else if(d.appType == 3){ }}
	用户端
	{{# } }}
</script>
<script type="text/html" id="status">
	{{#  if(d.status == 0){ }}
	普通更新
	{{#  } else if(d.status == 1){ }}
	强制更新
	{{# } }}
</script>
<script type="text/html" id="refuse">
	<ul class="layui-form" style="margin: 10px;">
		{{# if(d.osType == 0){ }}
		<div class="layui-form-item">
			<label class="layui-form-label">更新方式</label>
			<div class="layui-input-block">
					<select id="select" name="status" data-type="reload">
						{{# if(d.status == 0){ }}
						<option value="0" selected>普通更新</option>
						<option value="1" >强制更新</option>
						{{# }else if(d.status == 1){ }}
						<option value="0">普通更新</option>
						<option value="1"selected>强制更新</option>
						{{# }else{ }}
						<option value="0">普通更新</option>
						<option value="1">强制更新</option>
						{{# } }}
					</select>
			</div>
		</div>
		{{# } }}

		<div class="layui-form-item" >
			<label class="layui-form-label">版本号</label>
			<div class="layui-input-block">
				<input type="text" id = "version" name="version" value="{{d.version}}" required  lay-verify="required" placeholder="请输入版本号" autocomplete="off" class="layui-input">
			</div>
		</div>
		<div class="layui-form-item" >
			<label class="layui-form-label">Code</label>
			<div class="layui-input-block">
				<input type="text" id = "code" name="code" value="{{d.version}}" required  lay-verify="required" placeholder="请输入版本号" autocomplete="off" class="layui-input">
			</div>
		</div>

		{{# if(d.osType == 0){ }}
		<div class="layui-form-item" >
			<label class="layui-form-label">更新地址</label>
			<div class="layui-input-block">
				<input type="text" id = "url" name="url" required value="{{d.url}}"  lay-verify="required" placeholder="请输入更新地址" autocomplete="off" class="layui-input">
			</div>
		</div>
		{{# } }}

		<li class="layui-form-item" style="text-align:center;">
			<button type="submit" lay-submit lay-filter="*" class="layui-btn">提交</button>
		</li>
	</ul>
</script>

<script>
	function refrersh() {

		window.location.Reload();
    }
    layui.use('table', function(){
        var table = layui.table;

        //方法级渲染
        table.render({
            elem: '#LAY_table_user'

            ,url: '/version/ui/list'
            ,cols: [[
                /*{checkbox: true, fixed: true},*/
                {field:'id', width:80, title: 'ID', sort: true}
                ,{field:'osType', width:100, title: '系统类型',templet:'#osType'}
                ,{field:'appType', width:120, title: 'app类型',templet:'#appType'}
                ,{field:'status', width:120, title: '更新方式',templet:'#status'}
                ,{field:'version', width:165, title: '版本号'}
                ,{field:'code', width:165, title: 'Code'}
                ,{field:'url', width:165, title: '更新地址'}
                ,{fixed: 'right', width:150, align:'center', toolbar: '#barDemo'} //这里的toolbar值是模板元素的选择器
            ]]
            ,id: 'testReload'
            ,page: true
			,limit: 10
            ,height: 'full-65'
        });

    });
</script>

<script type="text/html" id="barDemo">
	<a class="layui-btn layui-btn-mini" lay-event="edit">编辑</a>
</script>

<script>
    //监听工具条
    layui.use('table', function(){

        var table = layui.table,form = layui.form,laytpl = layui.laytpl,$ = layui.$;
		table.on('tool(user)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
			var data = obj.data; //获得当前行数据
			var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
			var tr = obj.tr; //获得当前行 tr 的DOM对象

			if(layEvent === 'edit'){ //编辑
                layer.open({
                    type: 1
                    ,title:'更新版本'
                    ,area: '300px'
                    ,resize: false
                    ,content: laytpl($('#refuse').html()).render(data)
                    ,success: function(layero,index){
                        console.log(data);
                        layero.find('.layui-layer-content').css('overflow', 'visible');
                        form.render().on('submit(*)', function(datas){
                            datas.field.id = data.id
                            $.ajax({
                                url:'/version/ui/edit',
                                type:'POST',
                                dataType:'json',
                                data:datas.field,
                                success:function (res) {
                                    console.log(res);
                                    if(res.code < 2000){
                                        /*obj.update({
                                            status: '审核拒绝',
                                            desc: datas.field.desc
                                        });*/
                                        table.reload('testReload', {
                                            page: {
                                                curr: $('#page').val, //重新从第 1 页开始
                                            }
                                        });
                                    }else {
                                        layer.msg(res.msg);
                                    }
                                }
                            })
                            layer.close(index);
                        });
                    }
                });
			}
		});
    });
</script>
<script type="text/javascript" src="/edit/wangEditor.min.js"></script>
</body>
</html>